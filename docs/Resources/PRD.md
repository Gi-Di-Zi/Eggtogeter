# [Constraints Checklist]
- [x] 언어: 한국어 (Korean)
- [x] 경로: `@/docs/Plans/`
- [x] 3단계 프로토콜 준수

# EggTogether - 제품 요구사항 정의서 (PRD) v4 (2026-01-28)

## 1. 프로젝트 개요 (Overview)

### 1.1 프로젝트 명
**EggTogether** (에그투게더)

### 1.2 비전 및 목표
EggTogether는 **지도 기반의 위치 중심 사진 공유 및 타임라인 기록 서비스**입니다.
사용자의 소중한 추억을 단순한 리스트가 아닌 **지도 위의 발자취**로 시각화하며, 친구 및 지인과 함께 추억을 "알(Egg)"처럼 모으고 공유하는 경험을 제공합니다.

### 1.3 핵심 가치
- **Contextual**: 사진이 촬영된 '장소'와 '시간'을 직관적으로 연결.
- **Persistent**: 끊김 없는 지도 경험 (Persistent Map).
- **Social**: 친구와 메모리를 공유하고 함께 지도를 완성하는 경험.
- **Storytelling**: 단순 기록을 넘어선 '무빙 앨범'을 통한 서사적 공유.
- **Flexibility**: 사진이 없는 텍스트 전용 기록도 지도 위에 남길 수 있음.

---

## 2. 사용자 페르소나 (Target Personas)

### 2.1 여행 기록자 (The Traveler)
- 여행 경로와 방문한 장소의 사진을 지도 위에 예쁘게 남기고 싶어함.
- 사진의 위치 정보(GPS)가 자동으로 반영되길 원함.

### 2.2 커플/데이트 (The Memories)
- 데이트한 장소들을 지도에 기록하여 "우리가 함께한 지도"를 만들고 싶어함.
- 기념일이나 특정 장소를 검색해서 추억을 회상하고 싶어함.

### 2.3 소셜 커넥터 (The Socialite)
- 친구들과 지도와 사진을 공유하고 싶어함.
- 친구의 여행 기록을 자신의 지도 위에서 보고 싶어함.
- 여행 영상을 앨범으로 만들어 유튜브나 SNS에 공유하고 싶어함.

---

## 3. 기능 명세 (Feature Specifications)

### 3.1 핵심 기능 (Current Status)

| 구분 | 기능명 | 상세 설명 | 구현 상태 |
| :--- | :--- | :--- | :--- |
| **지도** | **Persistent Map** | 앱 전반에서 지도가 배경에 유지됨. | ✅ 완료 |
| **사진** | **Upload & Metadata** | EXIF 자동 위치/날짜 인식, 드래그 앤 드롭. | ✅ 완료 |
| **사진** | **Infinite Scroll** | 대량 데이터의 효율적 로딩. | ✅ 완료 |
| **사진** | **Text-Only Entry** | 사진 없이 텍스트(설명)만으로 기록 남기기 가능. | ✅ 완료 |
| **분류** | **Category System** | 사용자 정의 카테고리 및 색상 관리. | ✅ 완료 |
| **인증** | **Auth Flow** | 회원가입, 로그인, 비밀번호 찾기 (Supabase). | ✅ 완료 |
| **프로필** | **User Profile** | 별명, 아바타 설정 (DiceBear 자동 생성). | ✅ 완료 |
| **친구** | **Friend System** | 이메일/별명 검색, 친구 요청/수락. | ✅ 완료 |
| **공유** | **Photo Sharing** | 비공개/친구 전체/특정 친구 공유 설정. | ✅ 완료 |
| **공유** | **Friend Photos View** | 홈 화면에서 친구 사진 필터링 및 조회. | ✅ 완료 |
| **앨범** | **Moving Album** | 3D 지도 기반 이동 경로 애니메이션 생성 및 재생. | ✅ 완료 |

### 3.2 무빙 앨범 상세 기능 (Moving Album Details)

#### A. 애니메이션 엔진 (Animation Engine)
- **상태 기계(FSM)**: '준비-이동-정지-날짜변경'으로 이어지는 세밀한 상태 전이 구현.
- **포커스 효과**: 사진 도달 시 지도 애니메이션을 3초간 정지하여 몰입감 제공.
- **속도 제어**: 0.5x ~ 5x 범위의 실시간 속도 조절 지원.

#### B. 시각 요소 (Visual Elements)
- **3D 이동 수단**: 도보, 자동차, 비행기, 자전거, 버스, 지하철, 배 등 수단별 3D 모델 및 전용 아이콘 적용.
- **스네이킹 타임라인**: 지그재그 형태의 3라인 타임라인으로 대량의 사진을 한눈에 파악.
- **동적 오버레이**: 현재 위치의 날짜, 사진 설명, 폴라로이드 스타일 프레임 제공.
- **미니맵**: 전체 경로 중 현재 위치를 표시하는 2D 미니맵 오버레이.

#### C. 제작 도구 (Creation Tool)
- **드래그 앤 드롭**: 사진 선택 및 순서 조정.
- **구간 수단 설정**: 사진 사이의 이동 수단을 개별 설정 가능 (Persistence 보장).
- **미리보기**: 생성 전 지도 상의 대략적인 경로 미리보기 지원.

### 3.3 UI/UX 디자인 원칙 (Updated)

#### A. 지도 마커 디자인 (Persistent Map)
- **사진 마커**: 원형 썸네일 + 테두리(카테고리 컬러).
- **텍스트 마커**:
    - **스타일**: 화살표가 있는 **말풍선(Speech Bubble)** 형태.
    - **디자인**: 오버레이 감각의 **화이트 카드**(테두리 없음) + **강한 그림자(Deep Shadow)**로 부유감 강조.
    - **내용**: **설명(Description)**을 우선 표시하여 정보 전달력 강화.
- **이동 수단 마커**: 경로 상에서 실시간으로 이동하는 3D 오브젝트.

#### B. 카드 UI 통일성 (Card Consistencies)
- **규격 통일**: **Text-Only** 카드도 **Photo** 카드와 동일한 규격(Grid: 1:1 정사각형, List: 60x60px) 유지.
- **상호작용**: 홈 드로어의 카드를 클릭하면 **지도 표시 여부(Visibility)**가 즉시 토글됨.
- **UI 간소화**: 그리드 뷰의 불필요한 '보기/숨기기' 버튼 제거, 정보 오버레이 최적화.

### 3.4 향후 확장 계획 (Future Plans)

#### A. 콘텐츠 다각화
- **Web Scroll (Narrative)**: 스크롤 중심의 스토리텔링 뷰 (개발 예정).
- **AI Video (Media)**: AI 기반 영상 생성 및 다운로드 (개발 예정).
- **BGM 선택**: 무빙 앨범 재생 시 배경음악 추가 기능.

#### B. 기능 강화
- **통계 뷰**: 내가 다녀온 장소들에 대한 거리, 시간, 카테고리별 통계 시각화.
- **오프라인 모드**: 데이터 연결이 원활하지 않은 곳에서의 기록 저장 및 사후 동기화.

---

## 4. 사용자 흐름 (User Flows)

### 4.1 텍스트 기록 남기기 (Text Entry)
1.  **업로드**: 사진 없이 '위치'와 '설명' 입력.
2.  **지도 표시**: 지도에 **화이트 말풍선 마커** 생성 (설명 내용 표시).
3.  **관리**: 홈 드로어 및 사진 관리 페이지에서 텍스트 아이콘이 있는 카드로 확인 및 수정 가능.

### 4.2 홈 화면 인터랙션 (Map Control)
1.  **카드 클릭**: 홈 드로어의 앨범 카드를 클릭.
2.  **Toggle**: 해당 기록(마커)이 지도에서 **즉시 사라지거나 나타남**.
3.  **필터링**: 상단 필터로 친구별/카테고리별 마커 일괄 제어.

---

## 5. 기술 아키텍처 및 스키마 (Technical Architecture)

### 5.1 데이터 구조 (Schema Update)

#### `photos`
*   `storage_path`: `text` (**Nullable**) - 사진이 없는 텍스트 기록 허용.
*   `visibility`: `enum('private', 'all_friends', 'specific')` (default: 'private')
*   `share_list`: `uuid[]` (특정 친구 ID 배열).

#### `friends`
*   `id`: `uuid`, `requester_id`: `uuid`, `receiver_id`: `uuid`, `status`: `enum`.

---

## 6. 제약 사항 및 개발 규칙 (Constraints & Rules)
- **Windows 인코딩**: `UTF-8` 필수.
- **언어**: 한국어.
- **UX**: 텍스트 마커는 가독성을 위해 적절한 높이와 패딩을 유지하며, 클릭 시 불필요한 팝업을 띄우지 않음.
