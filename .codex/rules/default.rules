# .codex/rules/default.rules
# [ExecPolicy-WSL-Project-2026-02-25-R1]

# 삭제 금지
prefix_rule(pattern=["rm"], decision="forbidden", justification="삭제 금지 정책")
prefix_rule(pattern=["rmdir"], decision="forbidden", justification="삭제 금지 정책")
prefix_rule(pattern=["git", "rm"], decision="forbidden", justification="삭제 금지 정책")

# 이동/리네임은 승인
prefix_rule(pattern=["mv"], decision="prompt", justification="이동/리네임은 사전 승인 필요")
prefix_rule(pattern=["git", "mv"], decision="prompt", justification="이동/리네임은 사전 승인 필요")

# 위험 git
prefix_rule(pattern=["git", "reset", "--hard"], decision="prompt", justification="hard reset은 위험. 승인 필요")
prefix_rule(pattern=["git", "clean"], decision="prompt", justification="git clean은 삭제 포함 가능. 승인 필요")
prefix_rule(pattern=["git", "push", "--force"], decision="forbidden", justification="강제 push 금지")
prefix_rule(pattern=["git", "push", "--force-with-lease"], decision="forbidden", justification="강제 push 금지")
prefix_rule(pattern=["git", "push"], decision="prompt", justification="원격 반영 전 승인 필요")

# Docker: 조회/일반 허용, 파괴적/변경 가능성은 승인
prefix_rule(pattern=["docker", "ps"], decision="allow")
prefix_rule(pattern=["docker", "compose"], decision="allow")
prefix_rule(pattern=["docker", "logs"], decision="allow")
prefix_rule(pattern=["docker", "exec"], decision="prompt", justification="컨테이너 내부 명령은 영향 가능")
prefix_rule(pattern=["docker", "rm"], decision="prompt", justification="컨테이너 삭제 가능")
prefix_rule(pattern=["docker", "rmi"], decision="prompt", justification="이미지 삭제 가능")
prefix_rule(pattern=["docker", "volume", "rm"], decision="prompt", justification="볼륨 삭제 가능")
prefix_rule(pattern=["docker", "system", "prune"], decision="prompt", justification="정리/삭제 가능")

# Supabase: 일반 개발 흐름 허용, 파괴적은 승인
prefix_rule(pattern=["supabase", "start"], decision="allow")
prefix_rule(pattern=["supabase", "status"], decision="allow")
prefix_rule(pattern=["supabase", "stop"], decision="prompt", justification="중단 영향 확인 필요")
prefix_rule(pattern=["supabase", "migration", "list"], decision="allow")
prefix_rule(pattern=["supabase", "migration", "up"], decision="prompt", justification="마이그레이션 반영은 승인 필요")
prefix_rule(pattern=["supabase", "db", "push"], decision="prompt", justification="DB 반영은 승인 필요")
prefix_rule(pattern=["supabase", "db", "reset"], decision="prompt", justification="DB reset은 파괴적")

# 안전 조회
prefix_rule(pattern=["git", "status"], decision="allow")
prefix_rule(pattern=["git", "diff"], decision="allow")
prefix_rule(pattern=["git", "log"], decision="allow")
